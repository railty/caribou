function get(e){return document.getElementById(e)}function echo(e){document.write(e)}function newGame(){for(compGo=!1,board.init(),i=1;x*y>=i;i++)get("x"+i).checked=!1;get("plyr")&&get("comp")&&(get("plyr").value=board.scoreplyr,get("comp").value=board.scorecomp)}function gameOver(){var e=board.scorecomp,t=board.scoreplyr;t>e?update(1):e>t?(update(2),alert(text.lose)):(update(2),alert(text.tie))}function score(){board.boxes++,compGo?get("comp").value=++board.scorecomp:get("plyr").value=++board.scoreplyr}function checkForBox(e,t){if(!t)return!1;var i=!1,n=board.getBox(e);return n[1]&&board.incLines(n[1]),n[2]&&board.incLines(n[2]),n[1]&&board.drawBox(n[1])&&(i=!0,score(),board.drawPos(n[1])),n[2]&&board.drawBox(n[2])&&(i=!0,score(),board.drawPos(n[2])),i}function makeBestMove(){ai.init();for(var e=!1,t=!1,i=0,n=1;16>=n;n++){if(ai.typeTotal[n]>0)for(;!e;){for(;board.occ[i]||board.geti(i)||ai.moveType[i]!=n;)i=board.randPos();e=board.drawPos(i),t=checkForBox(i,e)}if(e)break}return t}function computerTurn(){for(;compGo;)makeBestMove()||(compGo=!compGo);board.full()&&(gameOver(),compGo=!1)}function computerFirstTurn(){for(var e=!0,t=1;t<=board.maxPos;t++)board.occ[t]&&(e=!1);compGo=e,computerTurn()}function convert(e){if(0==board.pick[1])return board.pick[1]=e,void 0;if(board.pick[1]==e)return board.resetPick(),void 0;if(0==board.pick[2]&&board.pick[1]!=e&&(board.pick[2]=e),board.checkPick()){var t=board.pick[1]-board.pick[2],i=0;(t==x||t==-x)&&(i=(board.radRow()-1)*(3*x-2)+(x-1)+2*board.radCol()-1),(1==t||-1==t)&&(i=(board.radRow()-1)*(3*x-2)+board.radCol()),board.occ[i]||checkForBox(i,board.drawPos(i))||(compGo=!compGo),board.resetPick(),board.full()?(gameOver(),compGo=!1):compGo&&computerTurn()}}function draw(){for(var e=0,t=0,i='<table bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">',n=1;y>=n;n++){i+="<tr>";for(var r=1;x>=r;r++)e++,i=i+'<td align="center"><input type="radio" id="x'+e+'"onclick="convert('+e+')"/></td>',x>r&&(t++,i=i+'<td align="center"><img id="i'+t+'" src="'+image[1].src+'" alt="" width="30" height="5"/></td>');if(i+="</tr>",y>n){for(i+="<tr>",r=1;x>=r;r++)t++,i=i+'<td align="center"><img id="i'+t+'" src="'+image[1].src+'" alt="" width="5" height="30"/></td>',x>r&&(t++,i=i+'<td align="center"><img id="i'+t+'" src="'+image[1].src+'" alt="" width="30" height="30"/></td>');i+="</tr>"}}i+="</table>",get("f").innerHTML=i,newGame()}function drawScore(){echo('<center style="margin-top:3px;"><table border="1" cellpadding="1" cellspacing="1" id="score"><tr>'),echo('<td bgcolor="silver">'+text.computer+':<input type="text" id="comp" size="2" value="0" disabled/></td>'),echo('<td bgcolor="silver">'+text.player+':<input type="text" id="plyr" size="2" value="0" disabled/></td>'),echo('<td bgcolor="silver"><input id="rstart" name="rstart" type="button" value="'+text.restart+'" onclick="draw()"/></td>'),echo("</tr></table></center>")}function drawButton(){echo('<br/><center><input type="button" name="pcFirstMove" id="pcFirstMove" onclick="computerFirstTurn()" value="'+text.computerFirst+'"/></center>')}if(pcCanMoveFirst!==!0&&pcCanMoveFirst!==!1&&alert("pcCanMoveFirst HAS IMPROPER FORMAT!!!"),(2>rows||rows>7)&&alert("rows MUST BE BETWEEN 2 AND 7!!!"),(2>cols||cols>7)&&alert("cols MUST BE BETWEEN 2 AND 7!!!"),6>rows*cols&&alert("board size IS TOO SMALL!!!"),isTest!==!1)var isTest=!0;if(!lang)var lang="en";var x=cols,y=rows,compGo=!1,blackLines=!1,image=new Array;image[1]=new Image,image[1].src="/caribou/games/images/clear.gif",image[2]=new Image,image[2].src="/caribou/games/images/dots/red.gif",image[3]=new Image,image[3].src="/caribou/games/images/dots/blue.gif",image[4]=new Image,image[4].src="/caribou/games/images/dots/black.gif";var text=new Object;"en"==lang?(text.alertText="You won! Congratulations! Don't forget to submit your answer below if it is not submitted automatically.",text.lose="Sorry, I won this game. You can try to win again.",text.tie="Tie game!",text.computer="Computer",text.player="Player",text.restart="Reset",text.computerFirst="Let the Computer Move First",text.rules='- In Dots, <font color="red">you</font> and the <font color="blue">computer</font> alternate in linking neighbouring dots by clicking them.<br/>- The goal is to complete more squares formed by either red or blue lines than the computer.<br/>- If you complete a square, you get to draw another line.<br/>',text.compFirstRule='- To have the computer start, click "Let the Computer Move First."<br/>',text.testRules='- Try as often as you like (but beware of the remaining test time!)<br/>- If you manage to win, scroll down, click "Submit Answer", and you will be awarded full marks.<br/>'):"fr"==lang&&(text.alertText="Vous avez gagn\u00E9! Votre victoire sera soumis automatiquement.",text.lose="D\u00E9sol\u00E9, j'ai gagn\u00E9 ce match. Veuillez essailler encore?",text.tie="C'est un \u00E9galit\u00E9! Cependant, vous devez gagner pour obtenir la note. Veuillez essailler encore?",text.computer="Ordinateur",text.player="Joueur",text.restart="Recommencer",text.computerFirst="Laisser l'ordinateur jouer en premier",text.rules='- Dans Points, <font color="red">vous</font> alternez avec l\'<font color="blue">ordinateur</font> pour connecter les points voisins par une ligne en les cliquant.<br/>- Le but est de compl&#233;ter plus de carr&#233;s form&#233;s par des lignes rouges ou bleues que l\'ordinateur.<br/>- Si vous compl&#233;tez un carr&#233;, vous pouvez dessinez une autre ligne.<br/>',text.compFirstRule="- Pour laisser l'ordinateur commencer, cliquez sur \"Laisser l'ordinateur jouer en premier\".<br/>",text.testRules='- Essayez aussi souvent que vous le souhaitez (mais m&#233;fiez-vous du temps qui vous reste pour compl&#233;ter le test!).<br/>- Si vous r&#233;ussissez &#224; gagner, cliquez sur "Soumettre R&#233;ponse" pour recevoir une note parfaite.<br/>');var update=function(e){get("answer").value=e,1==e&&(get("rstart").type="hidden",get("pcFirstMove").type="hidden",alert(text.alertText),get("question").submit())},board=new function(){this.occ=new Array,this.pick=new Array,this.boxes=0,this.maxBoxes=(x-1)*(y-1),this.maxPos=705,this.boxLines=new Array,this.boxPos=new Array,this.boxNeigh=new Array,this.scoreplyr=0,this.scorecomp=0,this.switchPick=function(){if(this.pick[1]>this.pick[2]){var e=this.pick[1];this.pick[1]=this.pick[2],this.pick[2]=e}},this.resetPick=function(){0!=this.pick[1]&&(get("x"+board.pick[1]).checked=!1),0!=this.pick[2]&&(get("x"+board.pick[2]).checked=!1),this.pick[1]=0,this.pick[2]=0},this.checkPick=function(){this.switchPick();var e=!0;(0==this.pick[1]||0==this.pick[2])&&(e=!1);for(var t=1;y>=t;t++)this.pick[1]==t*x&&this.pick[2]==t*x+1&&(e=!1);return e||this.resetPick(),e},this.radRow=function(){return Math.ceil(this.pick[1]/x)},this.radCol=function(){return 0==this.pick[1]%x?x:this.pick[1]%x},this.boxRow=function(e){return Math.ceil(e/(x-1))},this.boxCol=function(e){return 0==e%(x-1)?x-1:e%(x-1)},this.randPos=function(){return Math.ceil(Math.random()*board.maxPos)},this.geti=function(e){for(var t=1;t<=this.maxBoxes;t++)if(this.boxPos[t]==e)return t;return 0},this.getBox=function(e){for(var t=new Array(2),i=1,n=1;n<=this.maxBoxes;n++){for(var r=1;4>=r;r++)this.boxNeigh[n][r]==e&&(t[i]=this.boxPos[n],i++);if(i>2)break}return t},this.drawBox=function(e){var t=this.geti(e);return 0==t?!1:this.occ[this.boxNeigh[t][1]]&&this.occ[this.boxNeigh[t][2]]&&this.occ[this.boxNeigh[t][3]]&&this.occ[this.boxNeigh[t][4]]?!0:!1},this.incLines=function(e){this.boxLines[this.geti(e)]++},this.full=function(){for(var e=1;e<=this.maxPos;e++)if(!this.occ[e])return!1;return!0},this.drawPos=function(e){return this.occ[e]?!1:(get("i"+e).src=0==this.geti(e)&&blackLines?image[4].src:compGo?image[3].src:image[2].src,this.occ[e]=!0,!0)},this.init=function(){this.scoreplyr=0,this.scorecomp=0,this.boxes=0,this.maxBoxes=(x-1)*(y-1),this.maxPos=(x-1)*y+(2*x-1)*(y-1),this.pick[1]=0,this.pick[2]=0;for(var e=1;e<=this.maxBoxes;e++)this.boxLines[e]=0,this.boxPos[e]=(x-1)*this.boxRow(e)+(2*x-1)*(this.boxRow(e)-1)+2*this.boxCol(e),this.boxNeigh[e]=new Array,this.boxNeigh[e][1]=this.boxPos[e]+1,this.boxNeigh[e][2]=this.boxPos[e]-1,this.boxNeigh[e][3]=this.boxPos[e]-x-this.boxCol(e)+1,this.boxNeigh[e][4]=this.boxPos[e]+2*x-this.boxCol(e)-1;for(e=1;e<=board.maxPos;e++)this.occ[e]=!1;this.occ[0]=!0,this.boxLines[0]=0}},ai=new function(){this.ado={random:1,easy:2,medium:3,hard:4},this.diff=this.ado.random,this.moveType=new Array,this.typeTotal=new Array,this.setMoveType=function(e){var t=board.getBox(e);t[1]=board.geti(t[1]),t[2]=board.geti(t[2]);var i=board.boxLines[t[1]]+","+board.boxLines[t[2]];switch(i){case"3,2":this.moveType[e]=1,this.typeTotal[1]++;break;case"2,3":this.moveType[e]=2,this.typeTotal[2]++;break;case"3,3":this.moveType[e]=3,this.typeTotal[3]++;break;case"3,0":this.moveType[e]=4,this.typeTotal[4]++;break;case"0,3":this.moveType[e]=5,this.typeTotal[5]++;break;case"3,1":this.moveType[e]=6,this.typeTotal[6]++;break;case"1,3":this.moveType[e]=7,this.typeTotal[7]++;break;case"0,0":this.moveType[e]=8,this.typeTotal[8]++;break;case"0,1":this.moveType[e]=9,this.typeTotal[9]++;break;case"1,0":this.moveType[e]=10,this.typeTotal[10]++;break;case"1,1":this.moveType[e]=11,this.typeTotal[11]++;break;case"0,2":this.moveType[e]=12,this.typeTotal[12]++;break;case"2,0":this.moveType[e]=13,this.typeTotal[13]++;break;case"1,2":this.moveType[e]=14,this.typeTotal[14]++;break;case"2,1":this.moveType[e]=15,this.typeTotal[15]++;break;case"2,2":this.moveType[e]=16,this.typeTotal[16]++;break;default:this.moveType[e]=0,this.typeTotal[0]++}},this.init=function(){for(var e=0;16>=e;e++)this.typeTotal[e]=0;for(var t=1;t<=board.maxPos;t++)board.occ[t]||board.geti(t)||this.setMoveType(t)}};echo(text.rules),pcCanMoveFirst&&echo(text.compFirstRule),isTest&&echo(text.testRules),echo("<br/><br/>"),echo('<center><form id="f" name="f"></form></center>'),draw(),drawScore(),pcCanMoveFirst&&drawButton(),newGame();