function get(e){return document.getElementById(e)}function echo(e){document.write(e)}function preload(e,t,n){for(var i=new Array,a=0;t>=a;a++)i[a]=new Image,i[a].src="/caribou/games/images/bomb/"+e+"_"+a+"."+n;return i}function maxMines(e,t){return Math.ceil(.9*e*t)}function make2DArray(e,t){for(var n=new Array,i=0;e>i;i++)n[i]=new Array;for(var i=0;e>i;i++)for(var a=0;t>a;a++)n[i][a]=0;return n}function incNeigh(e,t){for(var n=-1;1>=n;n++)for(var i=-1;1>=i;i++)e+n>=0&&t+i>=0&&x>e+n&&y>t+i&&-1!=game[e+n][t+i]&&game[e+n][t+i]++}function initGame(e,t){var n=0,i=0,a=0;for(game=make2DArray(x,y);mines>n;)i=Math.floor(Math.random()*x),a=Math.floor(Math.random()*y),i==e&&a==t||-1==game[i][a]||(game[i][a]=-1,n++);for(var o=0;x>o;o++)for(var s=0;y>s;s++)-1==game[o][s]&&incNeigh(o,s);gameCreated=!0}function newGame(){gameCreated=!1,flag=make2DArray(x,y),clear=make2DArray(x,y),displayMines=mines,numFlags=0,numSquares=x*y,squares=numSquares-mines,editLED(),clk||switchClick(),get("smiley").src=smile[0].src;for(var e=0;x>e;e++)for(var t=0;y>t;t++)get("i"+e+"+"+t).src=sqRClick[0].src}function uncover(e,t){if(0==flag[e][t]&&!clear[e][t])if(-1==game[e][t])displayLoss(e,t);else if(get("i"+e+"+"+t).src=sqBoard[game[e][t]].src,squares--,clear[e][t]=1,flag[e][t]=0,0==game[e][t])for(var n=-1;1>=n;n++)for(var i=-1;1>=i;i++){var a=e+n,o=t+i;a>=0&&o>=0&&x>a&&y>o&&uncover(a,o)}}function changeMines(e){numFlags-=e,displayMines+=e,displayMines+numFlags>mines&&(displayMines=0),0>displayMines&&(displayMines=0),displayMines>mines&&(displayMines=mines)}function evalr(e,t){0==flag[e][t]?(flag[e][t]=1,changeMines(-1),get("i"+e+"+"+t).src=sqRClick[1].src):1==flag[e][t]&&(flag[e][t]=0,changeMines(1),get("i"+e+"+"+t).src=sqRClick[0].src)}function multiuncover(e,t){if(allowMultiUncover){for(var n,i,a=!0,o=0,s=-1;1>=s;s++)for(var r=-1;1>=r;r++)n=e+s,i=t+r,n>=0&&i>=0&&x>n&&y>i&&1==flag[n][i]&&o++;if(game[e][t]!=o&&(a=!1),a)for(var s=-1;1>=s;s++)for(var r=-1;1>=r;r++)n=e+s,i=t+r,n>=0&&i>=0&&x>n&&y>i&&uncover(n,i)}}function evall(e,t){gameCreated||initGame(e,t),clear[e][t]?multiuncover(e,t):uncover(e,t)}function eval(e,t,n){gameWon||(get("smiley").src,n.shiftKey||2==n.button||!clk?evalr(e,t):(0==n.button||clk)&&evall(e,t),editLED(),0==squares&&displayWin(),smileyClicked(!1))}function draw(e){var t=0,n=0,i='<table bgcolor="#bebebe" border="0" cellpadding="0" cellspacing="0">';for(i+="<tr>",i=i+'<td align="center"><img src="'+board[0].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',t=0;x>t;t++)i=i+'<td align="center"><img src="'+board[1].src+'" alt="" width="'+e+'" height="'+e+'"/></td>';for(i=i+'<td align="center"><img src="'+board[2].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',i+="</tr>",n=0;y>n;n++){for(i+="<tr>",i=i+'<td align="center"><img src="'+board[7].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',t=0;x>t;t++)i=i+'<td align="center" id="t'+t+"+"+n+'">',i=i+'<img id="i'+t+"+"+n+'" src="'+sqRClick[0].src+'" alt="" width="'+e+'" height="'+e+'" onmousedown="if (event.button == 0) smileyClicked(true)" onmouseup="eval('+t+","+n+',event)"/>',i+="</td>";i=i+'<td align="center"><img src="'+board[3].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',i+="</tr>"}for(i+="<tr>",i=i+'<td align="center"><img src="'+board[6].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',t=0;x>t;t++)i=i+'<td align="center"><img src="'+board[5].src+'" alt="" width="'+e+'" height="'+e+'"/></td>';i=i+'<td align="center"><img src="'+board[4].src+'" alt="" width="'+e+'" height="'+e+'"/></td>',i+="</tr>",i+="</table>",get("f").innerHTML=i,newGame()}function drawSmiley(e,t){var n=Math.floor(displayMines/100),i=Math.floor(displayMines/10)%10,a=displayMines%10;echo('<center><table width="'+e+'" bgcolor="#bebebe" border="0" cellpadding="0" cellspacing="0"><tr>'),echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="ledm0" src="'+ledm[n].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="ledm1" src="'+ledm[i].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="ledm2" src="'+ledm[a].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo('<td align="center" width="'+5*t+'%">'),echo('<img id="smiley" src="'+smile[0].src+'" alt="" width="'+2*t+'" height="'+2*t+'" onclick="newGame()" onmousedown="smileyClicked(0)" onmouseup="smileyClicked(false)"/></td>'),n=Math.floor(squares/100),i=Math.floor(squares/10)%10,a=squares%10,echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="leds0" src="'+leds[n].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="leds1" src="'+leds[i].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo('<td bgcolor="#000000">&nbsp;</td>'),echo('<td width="'+t+'"><img id="leds2" src="'+leds[a].src+'" alt="" width="'+t+'" height="'+2*t+'"/></td>'),echo("</tr></table></center>")}function switchClick(){clk=!clk,clk?(get("click_image").src=sqRClick[0].src,get("click_button").value=text.leftUncover):(get("click_image").src=sqRClick[1].src,get("click_button").value=text.leftFlag)}function drawClickButton(){echo('<center><table border="0" cellpadding="0" cellspacing="10"><tr>'),echo('<td><img id="click_image" src="'+sqRClick[0].src+'" alt=""/></td>'),echo('<td><input type="button" id="click_button" onclick="switchClick()" value="'+text.leftUncover+'"/></td>'),echo("</tr></table></center>")}function displayLoss(e,t){var n;get("smiley").src=smile[4].src;for(var i=0;x>i;i++)for(var a=0;y>a;a++)n=get("i"+i+"+"+a),-1==game[i][a]?i==e&&a==t?n.src=sqAfter[1].src:1==flag[i][a]||(n.src=sqAfter[0].src):n.src=1==flag[i][a]?sqAfter[2].src:sqBoard[game[i][a]].src;update(2)}function displayWin(){get("smiley").src=smile[3].src;for(var e=0;x>e;e++)for(var t=0;y>t;t++)-1==game[e][t]&&1!=flag[e][t]&&(get("i"+e+"+"+t).src=sqAfter[0].src);update(1)}function editLED(){var e=Math.floor(displayMines/100),t=Math.floor(displayMines/10)%10,n=displayMines%10;get("ledm0").src=ledm[e].src,get("ledm1").src=ledm[t].src,get("ledm2").src=ledm[n].src,e=Math.floor(squares/100),t=Math.floor(squares/10)%10,n=squares%10,get("leds0").src=leds[e].src,get("leds1").src=leds[t].src,get("leds2").src=leds[n].src}function smileyClicked(e){var t=get("smiley");(t.src!=smile[4].src&&t.src!=smile[3].src||0===e)&&(t.src=0===e?smile[1].src:e?smile[2].src:smile[0].src)}if(3>rows&&alert("rows HAS IMPROPER RANGE!!!"),3>cols&&alert("cols HAS IMPROPER RANGE!!!"),numMines>maxMines(rows,cols)/3&&alert("numMines HAS IMPROPER RANGE!!!"),isTest!==!1)var isTest=!0;if(!lang)var lang="en";var x=cols,y=rows,numSquares=x*y,mines=numMines,displayMines=mines,squares=numSquares-mines,numFlags=0,gameCreated=!1,gameWon=!1,clk=!0,game,flag,clear,size=20,ledm=preload("led",9,"gif"),leds=preload("led",9,"png"),board=preload("board",7,"gif"),smile=preload("smiley",4,"gif"),sqBoard=preload("mines",8,"png"),sqRClick=preload("sqRClick",2,"png"),sqAfter=preload("sqAfter",2,"png"),text=new Object;"en"==lang?(text.alertText="You won! Congratulations! Don't forget to submit your answer below if it is not submitted automatically.",text.leftUncover="Left Click Will Uncover Square",text.leftFlag="Left Click Will Place Flag",text.rules="<b>Rules</b><br/>- You win the game by uncovering all squares that are not bombs.<br/>- Uncover a bomb, and you lose the game.<br/>- Uncover a number, and it tells you how many bombs lay hidden in the eight surrounding squares.<br/><br/><b>Hints</b><br/>- If you think a spot is a bomb, you can mark it with a flag by holding down Shift and clicking (Shift+Click).<br/>- The green counter indicates how many more squares you have left to uncover before you win.<br/>- The red counter indicates the number of bombs remaining (assuming all your flags are bombs).<br/>",text.testRules='- Try as often as you like (but beware of the remaining test time!)<br/>- If you manage to win, scroll down, click "Submit Answer", and you will be awarded full marks.<br/>'):"fr"==lang&&(text.alertText="Vous avez gagn√©! Votre victoire sera soumis automatiquement.",text.leftUncover="clic gauche pour decouvrir une case",text.leftFlag="clic gauche pour placer un drapeau",text.rules="<b>R&#232;gles</b><br/>- Vous gagnez le jeu en d&#233;couvrant toutes les cases qui ne sont pas des bombes.<br/>- D&#233;couvrez une bombe, et vous perdez la partie.<br/>- D&#233;couvrez un num&#233;ro, et il vous indique le nombre de bombes qui se cachent dans les huit cases qui l'entourent.<br/><br/><b>Conseils</b><br/>- Si vous pensez qu'une case est une bombe, vous pouvez la marquer avec un drapeau en maintenant la touche \"shift\" et en cliquant (Shift + Cliquez).<br/>- Le compteur vert indique le nombre de cases qui vous reste &#224; d&#233;couvrir pour gagner.<br/>- Le compteur rouge indique le nombre de bombes restantes (en supposant que tous vos drapeaux sont des bombes).<br/>",text.testRules='- Essayez aussi souvent que vous le souhaitez (mais m&#233;fiez-vous du temps qui vous reste pour compl&#233;ter le test!).<br/>- Si vous r&#233;ussissez &#224; gagner, cliquez sur "Soumettre R&#233;ponse" pour recevoir une note parfaite.<br/>');var update=function(e){get("answer").value=e,1==e&&(alert(text.alertText),gameWon=!0,get("question").submit())};echo(text.rules),isTest&&echo(text.testRules),echo("<br/>"),drawSmiley(size*(x+2),size),echo('<center><form id="f" name="f"></form></center>'),draw(size),drawClickButton();